<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>بطاقة تهنئة رمضان</title>

<style>
        @font-face {
            font-family: 'DINNextArabic';
            src: url('DIN NEXT™️ ARABIC REGULAR.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }
    body {
        margin: 0;
        padding: 0;
        font-family: "Tajawal", sans-serif;
        background: linear-gradient(to bottom, #83888c, #4bb2a1);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        color: #222;
    }

    .inputbox {
        background: #fff;
        color: #222;
        width: 700px;
        min-height: 400px;
        padding: 35px 25px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 8px 20px rgba(131,136,140,0.2);
        display: none;
    }

    .inputbox.active {
        display: block;
    }

    .resbox {
        background: #f8f8f8;
        color: #222;
        width: 500px;
        min-height: 280px;
        padding: 50px 30px;
        border-radius: 20px;
        text-align: center;
        box-shadow: 0 8px 24px rgba(75,178,161,0.15);
        display: none;
    }

    .resbox.active {
        display: block;
    }

    h2 {
        margin-bottom: 20px;
        font-size: 22px;
        font-weight: bold;
    }


    input {
        width: 90%;
        padding: 12px;
        margin-top: 60px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 18px;
        text-align: center;
    }

    button {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 18px;
        cursor: pointer;
        font-weight: bold;
        margin: 8px;
         margin-top: 60px;
    }

    .btn-blue {
        background: #4bb2a1;
        color: #fff;
    }

    .btn-gray {
        background: #83888c;
        color: #fff;
    }

    .result-buttons {
        margin-top: 15px;
    }

    canvas {
       border-radius: 10px;
        margin-top: 15px;
        display: block;
        margin-left: auto;
        margin-right: auto;
        max-width: 500px; /* or any size you want for display */
        max-height: 350px;
        width: 100%;
        height: auto;
    }
</style>
</head>

<body>

<!-- Input Screen -->
<div id="inputBox" class="inputbox active">
    <h2>صمّم بطاقة تهنئة رمضان بإسمك</h2>

    <input type="text" id="username" placeholder="أكتب أسمك هنا ... على سبيل المثال أخوكم/ محمد الحداد">

    <div>
        <button class="btn-gray" onclick="resetForm()">إعادة تعيين</button>
        <button class="btn-blue" onclick="generateCard()">إنشاء التهنئة</button>
    </div>
</div>

<!-- Result Screen -->
<div id="resultBox" class="resbox">
    <h2>تهنئتك جاهزة</h2>
    <div class="result-buttons">
        <button id="downloadBtn" class="btn-blue" onclick="downloadImage()" disabled>تنزيل الصورة</button>
        <button class="btn-gray" onclick="backToForm()">إنشاء تهنئة أخرى</button>
    </div>
</div>

<script>
function generateCard() {

    const nameInput = document.getElementById("username");
    const name = nameInput.value.trim();
    // Restrict to 1 or 2 words only
    const wordCount = name.split(/\s+/).filter(Boolean).length;
    if (!name) return;
    if (wordCount > 3) {
        alert("الرجاء إدخال اسم مكون من كلمة أو كلمتين فقط.");
        nameInput.focus();
        return;
    }

    document.getElementById("inputBox").classList.remove("active");
    document.getElementById("resultBox").classList.add("active");

    // Only enable the download button after validation
    document.getElementById("downloadBtn").disabled = false;
}

function resetForm() {
    document.getElementById("username").value = "";
}

function backToForm() {
    document.getElementById("resultBox").classList.remove("active");
    document.getElementById("inputBox").classList.add("active");
    document.getElementById("downloadBtn").disabled = true;
}

function downloadImage() {
    const name = document.getElementById("username").value.trim() || "تهنئتك";
    const img = new Image();
    img.src = "Ramadan.jpg";
    img.onload = function() {
        const origCanvas = document.createElement('canvas');
        origCanvas.width = img.width;
        origCanvas.height = img.height;
        const ctx = origCanvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        // Load DINNextArabic font before drawing text
        const font = new FontFace('DINNextArabic', 'url("DIN NEXT™️ ARABIC REGULAR.otf")');
        font.load().then(function(loadedFont) {
            document.fonts.add(loadedFont);
            // Now safe to use the font in canvas (bold)
            let fontSize = 35;
            ctx.font = "bold " + fontSize + "px DINNextArabic";
            ctx.fillStyle = "white";
            ctx.textAlign = "center";
            let textBlockCenter = Math.round(img.width / 2); // Center horizontally
            const y = Math.round(img.height * (390 / 500)); // Keep same y
            ctx.fillText(name, textBlockCenter, y);
            origCanvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = name + ".png";
                document.body.appendChild(a);
                a.click();
                setTimeout(function() {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 150);
            });
        }).catch(function() {
            alert('تعذر تحميل الخط. سيتم استخدام الخط الافتراضي.');
            let fontSize = 40;
            ctx.font = "bold " + fontSize + "px sans-serif";
            ctx.fillStyle = "white";
            ctx.textAlign = "center";
            let textBlockCenter = Math.round(img.width / 2); // Center horizontally
            const y = Math.round(img.height * (390 / 500)); // Keep same y
            ctx.fillText(name, textBlockCenter, y);
            origCanvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = name + ".png";
                document.body.appendChild(a);
                a.click();
                setTimeout(function() {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 150);
            });
        });
    };
    img.onerror = function() {
        alert('حدث خطأ أثناء تحميل الصورة.');
    };
}
</script>

</body>
</html>